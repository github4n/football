<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>跟投</title>
<script src="js/jquery-1.10.2.min.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>
<link href="css/timeline.css" rel="stylesheet" type="text/css" />
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<link href="css/mui.css" rel="stylesheet" />
<link href="css/common.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="css/listPage.css" />
<link href="css/withBetting.css" rel="stylesheet" type="text/css" />

</head>
<body>
	<div class="betting_pay">
		<div class="top_block">
			<p class="align_left">京城虎哥</p>
			<p id="title">单场方案</p>
			<p class="align_right">近30天盈利率20%</p>
		</div>
		<div class="con_block">
			<div class="con_block_top clearfix">
				<a class="checkPlan" href="javascript:GoToUrl_T('expertPlan_detail.html')">查看方案 >></a>
			</div>
			<div class="con_block_middle">
				<span id="interestRate">0</span>% <i>预计盈利率</i>
			</div>
			<div class="con_block_bt">跟单截止时间:2016-10-10 23:00:00</div>
		</div>
		<div class="footer_tap">
			<div class="toggleBox clearfix">
				<div id="mySelect" class="mySelect pull-left upIcon">
					<p class="selectVal">
						投<i></i>积分
					</p>
					<ul class="selectList">
						<li class="defaultVal">投<i>2000</i>积分
						</li>
						<li>投<i>1000</i>积分
						</li>
						<li>投<i>500</i>积分
						</li>
						<li>投<i>200</i>积分
						</li>
						<li>投<i>100</i>积分
						</li>
					</ul>
				</div>
				<p class="pull-right rtTxt">
					预计收益:<span id="intergalNum" class="intergalNum"></span>积分
				</p>
			</div>
			<a type="button" id="js-submit" class="betBtn" href="javascript:playCustomized()">立即支付</a>
		</div>

	</div>
	<script src="js/common.js"></script>
	<script src="js/bettingPay.js"></script>
	<script src="js/data.js"></script>
	<script src="js/weixin_com.js"></script>
	<script type="text/javascript" charset="utf-8">
    
    	var priceArray;

        function GoToUrl_T(u) {
            location.href = u + "?experts_code=" + getQueryString("experts_code") + "&gameDate=" + time + "&serviceType=" +getQueryString("serviceType") 
       		 + "&type=" +getQueryString("type") + "&serviceId=" +getQueryString("serviceId") + "&service_code=" +getQueryString("service_code")
       		 + "&companyId=" +getQueryString("companyId") + "&service_name=" +getQueryString("service_name");
        }

//支付
        var temp_click = 0;
        function playCustomized() {
            // 验证积分是否足够
            var intergal=parseInt($('#mySelect .selectVal i').html());//投入积分
            var intergalNum = parseInt($("#intergalNum").text());//预计收入积分
            
            if (fl_user.Integral() < intergal) {
                tishi_error("您的积分不足。");
                location.href="followRecharge.html?experts_code=" + getQueryString("experts_code");
				
                return;
            }


            // 如果用户多次点击，则只进行一次调用
            if (temp_click > 0) {
                return;
            }
            temp_click = 1;


            var mcid = getQueryString("mcid");
            if (mcid == undefined || $.trim(mcid).length == 0) {
                mcid = "";
            }

            var data = GetData(fl_url.followPayConfig, {
                serviceId: getQueryString("serviceId"),
                phoneNum: fl_user.Mobile(),
                mcid: mcid,
                pointsNum: intergal,
                type:1,
                followOrder:1,
                stragegy_time:getQueryString("endTime"),
                win_amount:intergalNum
                
            });
            console.log(data);
            // 验证支付
            if (data == "{msg:'payFail'}") {
                tishi_error("支付暂不可用，稍后再试。");
                temp_click = 0;
                return;
            }
            
            data = JSON.parse(data);

//             if (data.appId == undefined) {
//                  location.href = "myCustomized_detail.html?tid=" + data.tid + "&experts_code=" + getQueryString("experts_code");
//             }
//             else {
//                 PayWeiXin(data.appId, data.timeStamp, data.nonceStr, data.package, data.signType, data.paySign, data.tid);
//             }
            temp_click = 0;
        }
  //数据初始化      
        var time = "";
        var earningRate = 0;
        $(function(){
        	var serviceCode = getQueryString("service_code");
        	var followTime = getQueryString("endTime");
        	var earningRate = getQueryString("earningRate");
        	var service_name = getQueryString("service_name");
        	
        	time = GetDateYMDHMS2(followTime);
       
        	$("#title").text(service_name);
        	
        	$(".con_block_bt").text("跟单截止时间:"+time );
        	$("#interestRate").text(earningRate);
        
        // 初始化绑定
            dataUrl = fl_url.singleDayList;

            var d_t_ydm = GetDateStr(0);
            var d_temp_n = new Date();
            if (d_temp_n.getHours() == 11 && d_temp_n.getMinutes() < 30 || d_temp_n.getHours() < 11) {
                d_t_ydm = GetDateStr(-1);
            }

            dataParam = {
                beginDate: d_t_ydm,
                days: 30,
                type: getQueryString("type"),
                serviceId: getQueryString("serviceId"),
                serviceType: getQueryString("serviceType"),
                service_code: getQueryString("service_code")
            };
            //$(".timeZtit").text(GetDataYear());

            var data = GetData(dataUrl, dataParam);

            // 处理图表数据
           
            if(JSON.parse(data).length==2){
            	BindChat(JSON.parse(data)[0],'container1');
            }else{
             	BindChat(JSON.parse(data)[0],'container');
            } 

			todayGameInfo = GetData(fl_url.getTodayGameInfo, {serviceId:getQueryString("serviceId")});
			notStartNum = todayGameInfo.notStartNum;

            // 绑定列表数据
            BindData(JSON.parse(data)[0]);

            //myScroll.refresh();
        })
		
        var MyNum = 0;
        function BindChat(data,divId) {
            var xAxis = new Array(), series = new Array();
            //data = JSON.parse(data);
            var minNum = 0;
            var maxNum = 0;
            var isMin = true;
            var isMax = true;
            var yisMin = true;
            var yisMax = true;
            var s_n_3 = 0;
            
            var i_l = 0;
            for (var i = data.length; i > 0 ; i--) {

                if (GetDateDiffDay(data[i - 1].date, GetDataYMD()).day == 0) {
                    i_l++;
                    continue;
                }
                var t_date = GetDateDiffDay(data[i-1].date, GetDateYMDHMS());
                if (t_date.day == 1 && t_date.hours < 11 || t_date.day == 1 && t_date.hours == 11 && t_date.minutes < 30) {
                    i_l++;
                    continue;
                }

                s_n_3 += parseInt(data[i - 1].number3);
                if (s_n_3 > maxNum) {
                    maxNum = s_n_3;
                }
                if (s_n_3 < minNum) {
                    minNum = s_n_3;
                }
                xAxis.push(data[i - 1].date);

                series.push(s_n_3);
            }

            var dataLength = data.length - 1 - i_l;

            if(minNum < 0){
            	MyNum = 10000 - minNum;
            }else{
            	MyNum = 10000;
            }
        }

     // 绑定数据html
        function BindData(data) {

            // 验证用户
            var userinfo = sessionStorage.UserInfo;
            try {
                userinfo = JSON.parse(userinfo);
            } catch (e) {
                console.log(e);
            }
            console.log(data);
            var tz = 0;
            var zj = 0;

            if (typeof (data) != undefined && data != null && data.length > 0) {
             
                for (var i = 0; i < data.length; i++) {

                   tz = MyNum;//本金
                   zj += parseInt(data[i].number3);//盈利
                   
            	} 
      	  	}
            $(".align_right").text("近30天盈利："+ parseInt((zj / tz) * 100)+"%");
 		}
    </script>

</body>
</html>
